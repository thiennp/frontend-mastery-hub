<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Loop Examples - Level 5</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .example {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .example h3 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            overflow-x: auto;
        }
        .output {
            background: #e8f5e8;
            border: 1px solid #28a745;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Event Loop Examples - Level 5</h1>
    <p>These examples demonstrate the JavaScript Event Loop and how different types of tasks are processed.</p>

    <!-- Example 1: Basic Event Loop -->
    <div class="example">
        <h3>1. Basic Event Loop - Call Stack, Task Queue, and Microtask Queue</h3>
        <p>This example shows the order of execution for synchronous code, promises, and setTimeout.</p>
        
        <div class="code-block">
            <pre><code>console.log('1. Synchronous code');

setTimeout(() => console.log('2. setTimeout (macrotask)'), 0);

Promise.resolve().then(() => console.log('3. Promise (microtask)'));

console.log('4. Synchronous code');

// Expected output:
// 1. Synchronous code
// 4. Synchronous code
// 3. Promise (microtask)
// 2. setTimeout (macrotask)</code></pre>
        </div>
        
        <button onclick="runBasicEventLoop()">Run Example</button>
        <div id="basicOutput" class="output"></div>
    </div>

    <!-- Example 2: Microtasks vs Macrotasks -->
    <div class="example">
        <h3>2. Microtasks vs Macrotasks Priority</h3>
        <p>This example demonstrates that microtasks (Promises) have higher priority than macrotasks (setTimeout).</p>
        
        <div class="code-block">
            <pre><code>console.log('Start');

setTimeout(() => console.log('setTimeout 1'), 0);
setTimeout(() => console.log('setTimeout 2'), 0);

Promise.resolve().then(() => {
    console.log('Promise 1');
    return Promise.resolve();
}).then(() => console.log('Promise 2'));

setTimeout(() => console.log('setTimeout 3'), 0);

console.log('End');</code></pre>
        </div>
        
        <button onclick="runMicrotaskMacrotask()">Run Example</button>
        <div id="microtaskOutput" class="output"></div>
    </div>

    <!-- Example 3: Event Loop with DOM Events -->
    <div class="example">
        <h3>3. Event Loop with DOM Events</h3>
        <p>This example shows how DOM events interact with the event loop.</p>
        
        <div class="code-block">
            <pre><code>// Click the button to see the order of execution
document.getElementById('testButton').addEventListener('click', () => {
    console.log('1. Click event handler');
    
    setTimeout(() => console.log('2. setTimeout in click handler'), 0);
    
    Promise.resolve().then(() => console.log('3. Promise in click handler'));
    
    console.log('4. End of click handler');
});</code></pre>
        </div>
        
        <button id="testButton" onclick="runDOMEventExample()">Click Me</button>
        <div id="domEventOutput" class="output"></div>
    </div>

    <!-- Example 4: Async/Await and Event Loop -->
    <div class="example">
        <h3>4. Async/Await and Event Loop</h3>
        <p>This example demonstrates how async/await functions interact with the event loop.</p>
        
        <div class="code-block">
            <pre><code>async function asyncExample() {
    console.log('1. Start of async function');
    
    setTimeout(() => console.log('2. setTimeout in async function'), 0);
    
    await Promise.resolve();
    console.log('3. After await');
    
    setTimeout(() => console.log('4. setTimeout after await'), 0);
    
    console.log('5. End of async function');
}

console.log('6. Before calling async function');
asyncExample();
console.log('7. After calling async function');</code></pre>
        </div>
        
        <button onclick="runAsyncAwaitExample()">Run Example</button>
        <div id="asyncAwaitOutput" class="output"></div>
    </div>

    <!-- Example 5: Event Loop Blocking -->
    <div class="example">
        <h3>5. Event Loop Blocking</h3>
        <p>This example shows how synchronous code can block the event loop.</p>
        
        <div class="code-block">
            <pre><code>console.log('Start');

setTimeout(() => console.log('setTimeout 1'), 0);
setTimeout(() => console.log('setTimeout 2'), 0);

// Blocking synchronous code
const start = Date.now();
while (Date.now() - start < 2000) {
    // Block for 2 seconds
}

console.log('End of blocking code');

setTimeout(() => console.log('setTimeout 3'), 0);</code></pre>
        </div>
        
        <button onclick="runBlockingExample()">Run Example (Will Block for 2s)</button>
        <div id="blockingOutput" class="output"></div>
    </div>

    <!-- Example 6: Event Loop Visualization -->
    <div class="example">
        <h3>6. Event Loop Visualization</h3>
        <p>This example provides a visual representation of the event loop in action.</p>
        
        <div class="code-block">
            <pre><code>class EventLoopVisualizer {
    constructor() {
        this.callStack = [];
        this.taskQueue = [];
        this.microtaskQueue = [];
        this.log = [];
    }
    
    log(message) {
        this.log.push(`[${new Date().toISOString()}] ${message}`);
        this.updateDisplay();
    }
    
    updateDisplay() {
        // Update the visual representation
        document.getElementById('callStack').textContent = this.callStack.join('\n');
        document.getElementById('taskQueue').textContent = this.taskQueue.join('\n');
        document.getElementById('microtaskQueue').textContent = this.microtaskQueue.join('\n');
        document.getElementById('eventLoopLog').innerHTML = this.log.join('<br>');
    }
}</code></pre>
        </div>
        
        <button onclick="startEventLoopVisualization()">Start Visualization</button>
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin: 20px 0;">
            <div>
                <h4>Call Stack</h4>
                <div id="callStack" class="log"></div>
            </div>
            <div>
                <h4>Task Queue</h4>
                <div id="taskQueue" class="log"></div>
            </div>
            <div>
                <h4>Microtask Queue</h4>
                <div id="microtaskQueue" class="log"></div>
            </div>
        </div>
        <div>
            <h4>Event Loop Log</h4>
            <div id="eventLoopLog" class="log"></div>
        </div>
    </div>

    <!-- Example 7: Promise Chaining and Event Loop -->
    <div class="example">
        <h3>7. Promise Chaining and Event Loop</h3>
        <p>This example shows how promise chaining affects the event loop.</p>
        
        <div class="code-block">
            <pre><code>console.log('1. Start');

Promise.resolve()
    .then(() => {
        console.log('2. First then');
        return Promise.resolve();
    })
    .then(() => {
        console.log('3. Second then');
        setTimeout(() => console.log('4. setTimeout in promise chain'), 0);
    })
    .then(() => {
        console.log('5. Third then');
    });

setTimeout(() => console.log('6. setTimeout outside promise'), 0);

console.log('7. End');</code></pre>
        </div>
        
        <button onclick="runPromiseChainingExample()">Run Example</button>
        <div id="promiseChainingOutput" class="output"></div>
    </div>

    <!-- Example 8: Event Loop with Web Workers -->
    <div class="example">
        <h3>8. Event Loop with Web Workers</h3>
        <p>This example demonstrates how Web Workers interact with the main thread's event loop.</p>
        
        <div class="code-block">
            <pre><code>// Main thread
console.log('1. Main thread start');

const worker = new Worker('worker.js');
worker.postMessage({ type: 'start', data: 'Hello Worker' });

worker.onmessage = (event) => {
    console.log('4. Message from worker:', event.data);
};

setTimeout(() => console.log('2. setTimeout in main thread'), 0);

Promise.resolve().then(() => console.log('3. Promise in main thread'));

console.log('5. Main thread end');</code></pre>
        </div>
        
        <button onclick="runWebWorkerExample()">Run Example</button>
        <div id="webWorkerOutput" class="output"></div>
    </div>

    <script>
        // Example 1: Basic Event Loop
        function runBasicEventLoop() {
            const output = document.getElementById('basicOutput');
            output.innerHTML = '';
            
            // Override console.log to capture output
            const originalLog = console.log;
            const logs = [];
            console.log = (...args) => {
                logs.push(args.join(' '));
                originalLog(...args);
            };
            
            console.log('1. Synchronous code');
            setTimeout(() => console.log('2. setTimeout (macrotask)'), 0);
            Promise.resolve().then(() => console.log('3. Promise (microtask)'));
            console.log('4. Synchronous code');
            
            // Restore console.log
            console.log = originalLog;
            
            // Display output
            setTimeout(() => {
                output.innerHTML = logs.join('<br>');
            }, 100);
        }

        // Example 2: Microtasks vs Macrotasks
        function runMicrotaskMacrotask() {
            const output = document.getElementById('microtaskOutput');
            output.innerHTML = '';
            
            const originalLog = console.log;
            const logs = [];
            console.log = (...args) => {
                logs.push(args.join(' '));
                originalLog(...args);
            };
            
            console.log('Start');
            setTimeout(() => console.log('setTimeout 1'), 0);
            setTimeout(() => console.log('setTimeout 2'), 0);
            
            Promise.resolve().then(() => {
                console.log('Promise 1');
                return Promise.resolve();
            }).then(() => console.log('Promise 2'));
            
            setTimeout(() => console.log('setTimeout 3'), 0);
            console.log('End');
            
            console.log = originalLog;
            
            setTimeout(() => {
                output.innerHTML = logs.join('<br>');
            }, 100);
        }

        // Example 3: DOM Events
        function runDOMEventExample() {
            const output = document.getElementById('domEventOutput');
            output.innerHTML = '';
            
            const originalLog = console.log;
            const logs = [];
            console.log = (...args) => {
                logs.push(args.join(' '));
                originalLog(...args);
            };
            
            console.log('1. Click event handler');
            setTimeout(() => console.log('2. setTimeout in click handler'), 0);
            Promise.resolve().then(() => console.log('3. Promise in click handler'));
            console.log('4. End of click handler');
            
            console.log = originalLog;
            
            setTimeout(() => {
                output.innerHTML = logs.join('<br>');
            }, 100);
        }

        // Example 4: Async/Await
        async function runAsyncAwaitExample() {
            const output = document.getElementById('asyncAwaitOutput');
            output.innerHTML = '';
            
            const originalLog = console.log;
            const logs = [];
            console.log = (...args) => {
                logs.push(args.join(' '));
                originalLog(...args);
            };
            
            async function asyncExample() {
                console.log('1. Start of async function');
                setTimeout(() => console.log('2. setTimeout in async function'), 0);
                await Promise.resolve();
                console.log('3. After await');
                setTimeout(() => console.log('4. setTimeout after await'), 0);
                console.log('5. End of async function');
            }
            
            console.log('6. Before calling async function');
            await asyncExample();
            console.log('7. After calling async function');
            
            console.log = originalLog;
            
            setTimeout(() => {
                output.innerHTML = logs.join('<br>');
            }, 100);
        }

        // Example 5: Blocking
        function runBlockingExample() {
            const output = document.getElementById('blockingOutput');
            output.innerHTML = '';
            
            const originalLog = console.log;
            const logs = [];
            console.log = (...args) => {
                logs.push(args.join(' '));
                originalLog(...args);
            };
            
            console.log('Start');
            setTimeout(() => console.log('setTimeout 1'), 0);
            setTimeout(() => console.log('setTimeout 2'), 0);
            
            const start = Date.now();
            while (Date.now() - start < 2000) {
                // Block for 2 seconds
            }
            
            console.log('End of blocking code');
            setTimeout(() => console.log('setTimeout 3'), 0);
            
            console.log = originalLog;
            
            setTimeout(() => {
                output.innerHTML = logs.join('<br>');
            }, 100);
        }

        // Example 6: Event Loop Visualization
        let visualizer;
        function startEventLoopVisualization() {
            visualizer = new EventLoopVisualizer();
            visualizer.log('Starting event loop visualization...');
            
            // Simulate some operations
            setTimeout(() => {
                visualizer.log('setTimeout 1 executed');
            }, 1000);
            
            setTimeout(() => {
                visualizer.log('setTimeout 2 executed');
            }, 2000);
            
            Promise.resolve().then(() => {
                visualizer.log('Promise 1 executed');
            });
            
            Promise.resolve().then(() => {
                visualizer.log('Promise 2 executed');
            });
        }

        class EventLoopVisualizer {
            constructor() {
                this.callStack = [];
                this.taskQueue = [];
                this.microtaskQueue = [];
                this.log = [];
            }
            
            log(message) {
                this.log.push(`[${new Date().toISOString()}] ${message}`);
                this.updateDisplay();
            }
            
            updateDisplay() {
                document.getElementById('callStack').textContent = this.callStack.join('\n');
                document.getElementById('taskQueue').textContent = this.taskQueue.join('\n');
                document.getElementById('microtaskQueue').textContent = this.microtaskQueue.join('\n');
                document.getElementById('eventLoopLog').innerHTML = this.log.join('<br>');
            }
        }

        // Example 7: Promise Chaining
        function runPromiseChainingExample() {
            const output = document.getElementById('promiseChainingOutput');
            output.innerHTML = '';
            
            const originalLog = console.log;
            const logs = [];
            console.log = (...args) => {
                logs.push(args.join(' '));
                originalLog(...args);
            };
            
            console.log('1. Start');
            
            Promise.resolve()
                .then(() => {
                    console.log('2. First then');
                    return Promise.resolve();
                })
                .then(() => {
                    console.log('3. Second then');
                    setTimeout(() => console.log('4. setTimeout in promise chain'), 0);
                })
                .then(() => {
                    console.log('5. Third then');
                });
            
            setTimeout(() => console.log('6. setTimeout outside promise'), 0);
            console.log('7. End');
            
            console.log = originalLog;
            
            setTimeout(() => {
                output.innerHTML = logs.join('<br>');
            }, 100);
        }

        // Example 8: Web Workers
        function runWebWorkerExample() {
            const output = document.getElementById('webWorkerOutput');
            output.innerHTML = '';
            
            const originalLog = console.log;
            const logs = [];
            console.log = (...args) => {
                logs.push(args.join(' '));
                originalLog(...args);
            };
            
            console.log('1. Main thread start');
            
            // Create a simple worker inline
            const workerCode = `
                self.onmessage = function(event) {
                    console.log('Worker received:', event.data);
                    setTimeout(() => {
                        self.postMessage('Worker response');
                    }, 1000);
                };
            `;
            
            const blob = new Blob([workerCode], { type: 'application/javascript' });
            const worker = new Worker(URL.createObjectURL(blob));
            
            worker.postMessage({ type: 'start', data: 'Hello Worker' });
            
            worker.onmessage = (event) => {
                console.log('4. Message from worker:', event.data);
            };
            
            setTimeout(() => console.log('2. setTimeout in main thread'), 0);
            Promise.resolve().then(() => console.log('3. Promise in main thread'));
            console.log('5. Main thread end');
            
            console.log = originalLog;
            
            setTimeout(() => {
                output.innerHTML = logs.join('<br>');
                worker.terminate();
            }, 2000);
        }
    </script>
</body>
</html>


