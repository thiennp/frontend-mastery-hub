<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promises Examples - Level 4</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 30px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #fafafa;
        }
        
        .section h2 {
            color: #333;
            margin-top: 0;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .demo-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .demo-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .demo-button:active {
            transform: translateY(0);
        }
        
        .result {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: #fed7d7;
            color: #c53030;
            border: 1px solid #feb2b2;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .success {
            background: #c6f6d5;
            color: #2f855a;
            border: 1px solid #9ae6b4;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .card h3 {
            margin-top: 0;
            color: #2d3748;
        }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .status.pending {
            background: #fef5e7;
            color: #d69e2e;
        }
        
        .status.fulfilled {
            background: #c6f6d5;
            color: #2f855a;
        }
        
        .status.rejected {
            background: #fed7d7;
            color: #c53030;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Promises Examples</h1>
            <p>Level 4 - Frontend Mastery Hub</p>
        </div>
        
        <div class="content">
            <!-- Basic Promises Section -->
            <div class="section">
                <h2>1. Basic Promises</h2>
                <p>Understanding the fundamental concepts of Promises in JavaScript.</p>
                
                <div class="code-block">
// Creating a Promise
const myPromise = new Promise((resolve, reject) => {
    // Simulate async operation
    setTimeout(() => {
        const success = Math.random() > 0.5;
        if (success) {
            resolve("Promise resolved successfully!");
        } else {
            reject(new Error("Promise rejected!"));
        }
    }, 1000);
});

// Using the Promise
myPromise
    .then(result => console.log("Success:", result))
    .catch(error => console.error("Error:", error))
    .finally(() => console.log("Promise completed"));
                </div>
                
                <button class="demo-button" onclick="demoBasicPromises()">Demo Basic Promises</button>
                <div id="basic-result" class="result"></div>
            </div>
            
            <!-- Promise States Section -->
            <div class="section">
                <h2>2. Promise States</h2>
                <p>Understanding the three states of a Promise: pending, fulfilled, and rejected.</p>
                
                <div class="code-block">
// Promise states demonstration
function createPromise(delay, shouldResolve) {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            if (shouldResolve) {
                resolve(`Resolved after ${delay}ms`);
            } else {
                reject(new Error(`Rejected after ${delay}ms`));
            }
        }, delay);
    });
}

// Create promises with different outcomes
const pendingPromise = createPromise(2000, true);
const fulfilledPromise = createPromise(1000, true);
const rejectedPromise = createPromise(1500, false);

console.log("Promise states:", {
    pending: pendingPromise,
    fulfilled: fulfilledPromise,
    rejected: rejectedPromise
});
                </div>
                
                <button class="demo-button" onclick="demoPromiseStates()">Demo Promise States</button>
                <div id="states-result" class="result"></div>
            </div>
            
            <!-- Promise Chaining Section -->
            <div class="section">
                <h2>3. Promise Chaining</h2>
                <p>Chaining multiple asynchronous operations together using .then().</p>
                
                <div class="code-block">
// Promise chaining example
function fetchUser(id) {
    return new Promise(resolve => {
        setTimeout(() => resolve({ id, name: `User ${id}` }), 500);
    });
}

function fetchUserPosts(userId) {
    return new Promise(resolve => {
        setTimeout(() => resolve([
            { id: 1, title: "Post 1", userId },
            { id: 2, title: "Post 2", userId }
        ]), 300);
    });
}

function fetchPostComments(postId) {
    return new Promise(resolve => {
        setTimeout(() => resolve([
            { id: 1, text: "Great post!", postId },
            { id: 2, text: "Thanks for sharing!", postId }
        ]), 200);
    });
}

// Chain the promises
fetchUser(1)
    .then(user => {
        console.log("User:", user);
        return fetchUserPosts(user.id);
    })
    .then(posts => {
        console.log("Posts:", posts);
        return fetchPostComments(posts[0].id);
    })
    .then(comments => {
        console.log("Comments:", comments);
    })
    .catch(error => {
        console.error("Error in chain:", error);
    });
                </div>
                
                <button class="demo-button" onclick="demoPromiseChaining()">Demo Promise Chaining</button>
                <div id="chaining-result" class="result"></div>
            </div>
            
            <!-- Promise.all Section -->
            <div class="section">
                <h2>4. Promise.all()</h2>
                <p>Execute multiple promises in parallel and wait for all to complete.</p>
                
                <div class="code-block">
// Promise.all example
function fetchData(id, delay) {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            const success = Math.random() > 0.1; // 90% success rate
            if (success) {
                resolve({ id, data: `Data ${id}`, timestamp: Date.now() });
            } else {
                reject(new Error(`Failed to fetch data ${id}`));
            }
        }, delay);
    });
}

// Execute multiple promises in parallel
const promises = [
    fetchData(1, 1000),
    fetchData(2, 1500),
    fetchData(3, 800),
    fetchData(4, 1200)
];

Promise.all(promises)
    .then(results => {
        console.log("All promises resolved:", results);
    })
    .catch(error => {
        console.error("One or more promises failed:", error);
    });
                </div>
                
                <button class="demo-button" onclick="demoPromiseAll()">Demo Promise.all()</button>
                <div id="all-result" class="result"></div>
            </div>
            
            <!-- Promise.allSettled Section -->
            <div class="section">
                <h2>5. Promise.allSettled()</h2>
                <p>Wait for all promises to settle (either resolve or reject) and get all results.</p>
                
                <div class="code-block">
// Promise.allSettled example
function fetchDataWithRandomFailure(id, delay) {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            const success = Math.random() > 0.3; // 70% success rate
            if (success) {
                resolve({ id, data: `Data ${id}`, timestamp: Date.now() });
            } else {
                reject(new Error(`Failed to fetch data ${id}`));
            }
        }, delay);
    });
}

// Execute promises and get all results
const promises = [
    fetchDataWithRandomFailure(1, 1000),
    fetchDataWithRandomFailure(2, 1500),
    fetchDataWithRandomFailure(3, 800),
    fetchDataWithRandomFailure(4, 1200)
];

Promise.allSettled(promises)
    .then(results => {
        console.log("All promises settled:", results);
        results.forEach((result, index) => {
            if (result.status === 'fulfilled') {
                console.log(`Promise ${index + 1}: Success -`, result.value);
            } else {
                console.log(`Promise ${index + 1}: Failed -`, result.reason);
            }
        });
    });
                </div>
                
                <button class="demo-button" onclick="demoPromiseAllSettled()">Demo Promise.allSettled()</button>
                <div id="settled-result" class="result"></div>
            </div>
            
            <!-- Promise.race Section -->
            <div class="section">
                <h2>6. Promise.race()</h2>
                <p>Execute multiple promises and resolve with the first one that completes.</p>
                
                <div class="code-block">
// Promise.race example
function fetchFromSource(source, delay) {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            const success = Math.random() > 0.2; // 80% success rate
            if (success) {
                resolve({ source, data: `Data from ${source}`, timestamp: Date.now() });
            } else {
                reject(new Error(`Failed to fetch from ${source}`));
            }
        }, delay);
    });
}

// Race multiple data sources
const sources = [
    fetchFromSource("API", 2000),
    fetchFromSource("Cache", 500),
    fetchFromSource("Database", 1500),
    fetchFromSource("CDN", 1000)
];

Promise.race(sources)
    .then(result => {
        console.log("First source to respond:", result);
    })
    .catch(error => {
        console.error("All sources failed:", error);
    });
                </div>
                
                <button class="demo-button" onclick="demoPromiseRace()">Demo Promise.race()</button>
                <div id="race-result" class="result"></div>
            </div>
            
            <!-- Promise.any Section -->
            <div class="section">
                <h2>7. Promise.any()</h2>
                <p>Execute multiple promises and resolve with the first one that succeeds.</p>
                
                <div class="code-block">
// Promise.any example
function fetchFromSource(source, delay, successRate) {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            const success = Math.random() > (1 - successRate);
            if (success) {
                resolve({ source, data: `Data from ${source}`, timestamp: Date.now() });
            } else {
                reject(new Error(`Failed to fetch from ${source}`));
            }
        }, delay);
    });
}

// Try multiple sources, get first successful one
const sources = [
    fetchFromSource("Primary API", 2000, 0.3), // 30% success rate
    fetchFromSource("Backup API", 1500, 0.7),  // 70% success rate
    fetchFromSource("Cache", 500, 0.9),        // 90% success rate
    fetchFromSource("Database", 1000, 0.6)     // 60% success rate
];

Promise.any(sources)
    .then(result => {
        console.log("First successful source:", result);
    })
    .catch(error => {
        console.error("All sources failed:", error);
    });
                </div>
                
                <button class="demo-button" onclick="demoPromiseAny()">Demo Promise.any()</button>
                <div id="any-result" class="result"></div>
            </div>
            
            <!-- Error Handling Section -->
            <div class="section">
                <h2>8. Error Handling in Promises</h2>
                <p>Proper error handling and recovery strategies in Promise chains.</p>
                
                <div class="code-block">
// Error handling example
function fetchDataWithRetry(id, maxRetries = 3) {
    return new Promise((resolve, reject) => {
        let attempts = 0;
        
        function attempt() {
            attempts++;
            const success = Math.random() > 0.4; // 60% success rate
            
            if (success) {
                resolve({ id, data: `Data ${id}`, attempts });
            } else if (attempts < maxRetries) {
                console.log(`Attempt ${attempts} failed, retrying...`);
                setTimeout(attempt, 1000 * attempts); // Exponential backoff
            } else {
                reject(new Error(`Failed after ${maxRetries} attempts`));
            }
        }
        
        attempt();
    });
}

// Error handling with fallback
fetchDataWithRetry(1)
    .then(data => {
        console.log("Success:", data);
        return data;
    })
    .catch(error => {
        console.error("Primary fetch failed:", error);
        // Fallback to cached data
        return { id: 1, data: "Cached data", fromCache: true };
    })
    .then(data => {
        console.log("Final result:", data);
    });
                </div>
                
                <button class="demo-button" onclick="demoErrorHandling()">Demo Error Handling</button>
                <div id="error-result" class="result"></div>
            </div>
            
            <!-- Custom Promise Utilities Section -->
            <div class="section">
                <h2>9. Custom Promise Utilities</h2>
                <p>Creating utility functions to work with Promises more effectively.</p>
                
                <div class="code-block">
// Custom Promise utilities
class PromiseUtils {
    // Delay utility
    static delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    // Timeout utility
    static timeout(promise, ms) {
        return Promise.race([
            promise,
            new Promise((_, reject) => 
                setTimeout(() => reject(new Error('Timeout')), ms)
            )
        ]);
    }
    
    // Retry utility
    static retry(fn, maxRetries = 3, delay = 1000) {
        return new Promise((resolve, reject) => {
            function attempt(attempts) {
                fn()
                    .then(resolve)
                    .catch(error => {
                        if (attempts < maxRetries) {
                            setTimeout(() => attempt(attempts + 1), delay * attempts);
                        } else {
                            reject(error);
                        }
                    });
            }
            attempt(1);
        });
    }
    
    // Batch processing utility
    static batch(promises, batchSize = 3) {
        const results = [];
        
        function processBatch(batch) {
            return Promise.allSettled(batch).then(batchResults => {
                results.push(...batchResults);
            });
        }
        
        const batches = [];
        for (let i = 0; i < promises.length; i += batchSize) {
            batches.push(promises.slice(i, i + batchSize));
        }
        
        return Promise.all(batches.map(processBatch)).then(() => results);
    }
}

// Using the utilities
PromiseUtils.delay(1000)
    .then(() => console.log("Delayed execution"))
    .catch(console.error);
                </div>
                
                <button class="demo-button" onclick="demoCustomUtilities()">Demo Custom Utilities</button>
                <div id="utilities-result" class="result"></div>
            </div>
        </div>
    </div>

    <script>
        // Utility function to display results
        function displayResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = content;
            element.className = `result ${type}`;
        }
        
        // Basic promises demo
        function demoBasicPromises() {
            displayResult('basic-result', 'Loading...', 'info');
            
            const myPromise = new Promise((resolve, reject) => {
                setTimeout(() => {
                    const success = Math.random() > 0.5;
                    if (success) {
                        resolve("Promise resolved successfully!");
                    } else {
                        reject(new Error("Promise rejected!"));
                    }
                }, 1000);
            });
            
            myPromise
                .then(result => {
                    displayResult('basic-result', `Success: ${result}`, 'success');
                })
                .catch(error => {
                    displayResult('basic-result', `Error: ${error.message}`, 'error');
                })
                .finally(() => {
                    console.log("Promise completed");
                });
        }
        
        // Promise states demo
        function demoPromiseStates() {
            displayResult('states-result', 'Loading...', 'info');
            
            function createPromise(delay, shouldResolve) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        if (shouldResolve) {
                            resolve(`Resolved after ${delay}ms`);
                        } else {
                            reject(new Error(`Rejected after ${delay}ms`));
                        }
                    }, delay);
                });
            }
            
            const promises = [
                createPromise(2000, true),
                createPromise(1000, true),
                createPromise(1500, false)
            ];
            
            let results = [];
            let completed = 0;
            
            promises.forEach((promise, index) => {
                promise
                    .then(result => {
                        results.push(`Promise ${index + 1}: ${result}`);
                        completed++;
                        if (completed === promises.length) {
                            displayResult('states-result', results.join('\n'), 'success');
                        }
                    })
                    .catch(error => {
                        results.push(`Promise ${index + 1}: ${error.message}`);
                        completed++;
                        if (completed === promises.length) {
                            displayResult('states-result', results.join('\n'), 'success');
                        }
                    });
            });
        }
        
        // Promise chaining demo
        function demoPromiseChaining() {
            displayResult('chaining-result', 'Loading...', 'info');
            
            function fetchUser(id) {
                return new Promise(resolve => {
                    setTimeout(() => resolve({ id, name: `User ${id}` }), 500);
                });
            }
            
            function fetchUserPosts(userId) {
                return new Promise(resolve => {
                    setTimeout(() => resolve([
                        { id: 1, title: "Post 1", userId },
                        { id: 2, title: "Post 2", userId }
                    ]), 300);
                });
            }
            
            function fetchPostComments(postId) {
                return new Promise(resolve => {
                    setTimeout(() => resolve([
                        { id: 1, text: "Great post!", postId },
                        { id: 2, text: "Thanks for sharing!", postId }
                    ]), 200);
                });
            }
            
            let result = "";
            
            fetchUser(1)
                .then(user => {
                    result += `User: ${JSON.stringify(user)}\n`;
                    return fetchUserPosts(user.id);
                })
                .then(posts => {
                    result += `Posts: ${JSON.stringify(posts, null, 2)}\n`;
                    return fetchPostComments(posts[0].id);
                })
                .then(comments => {
                    result += `Comments: ${JSON.stringify(comments, null, 2)}\n`;
                    displayResult('chaining-result', result, 'success');
                })
                .catch(error => {
                    displayResult('chaining-result', `Error in chain: ${error.message}`, 'error');
                });
        }
        
        // Promise.all demo
        function demoPromiseAll() {
            displayResult('all-result', 'Loading...', 'info');
            
            function fetchData(id, delay) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const success = Math.random() > 0.1;
                        if (success) {
                            resolve({ id, data: `Data ${id}`, timestamp: Date.now() });
                        } else {
                            reject(new Error(`Failed to fetch data ${id}`));
                        }
                    }, delay);
                });
            }
            
            const promises = [
                fetchData(1, 1000),
                fetchData(2, 1500),
                fetchData(3, 800),
                fetchData(4, 1200)
            ];
            
            Promise.all(promises)
                .then(results => {
                    displayResult('all-result', `All promises resolved:\n${JSON.stringify(results, null, 2)}`, 'success');
                })
                .catch(error => {
                    displayResult('all-result', `One or more promises failed: ${error.message}`, 'error');
                });
        }
        
        // Promise.allSettled demo
        function demoPromiseAllSettled() {
            displayResult('settled-result', 'Loading...', 'info');
            
            function fetchDataWithRandomFailure(id, delay) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const success = Math.random() > 0.3;
                        if (success) {
                            resolve({ id, data: `Data ${id}`, timestamp: Date.now() });
                        } else {
                            reject(new Error(`Failed to fetch data ${id}`));
                        }
                    }, delay);
                });
            }
            
            const promises = [
                fetchDataWithRandomFailure(1, 1000),
                fetchDataWithRandomFailure(2, 1500),
                fetchDataWithRandomFailure(3, 800),
                fetchDataWithRandomFailure(4, 1200)
            ];
            
            Promise.allSettled(promises)
                .then(results => {
                    let result = "All promises settled:\n";
                    results.forEach((result, index) => {
                        if (result.status === 'fulfilled') {
                            result += `Promise ${index + 1}: Success - ${JSON.stringify(result.value)}\n`;
                        } else {
                            result += `Promise ${index + 1}: Failed - ${result.reason.message}\n`;
                        }
                    });
                    displayResult('settled-result', result, 'success');
                });
        }
        
        // Promise.race demo
        function demoPromiseRace() {
            displayResult('race-result', 'Loading...', 'info');
            
            function fetchFromSource(source, delay) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const success = Math.random() > 0.2;
                        if (success) {
                            resolve({ source, data: `Data from ${source}`, timestamp: Date.now() });
                        } else {
                            reject(new Error(`Failed to fetch from ${source}`));
                        }
                    }, delay);
                });
            }
            
            const sources = [
                fetchFromSource("API", 2000),
                fetchFromSource("Cache", 500),
                fetchFromSource("Database", 1500),
                fetchFromSource("CDN", 1000)
            ];
            
            Promise.race(sources)
                .then(result => {
                    displayResult('race-result', `First source to respond: ${JSON.stringify(result, null, 2)}`, 'success');
                })
                .catch(error => {
                    displayResult('race-result', `All sources failed: ${error.message}`, 'error');
                });
        }
        
        // Promise.any demo
        function demoPromiseAny() {
            displayResult('any-result', 'Loading...', 'info');
            
            function fetchFromSource(source, delay, successRate) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const success = Math.random() > (1 - successRate);
                        if (success) {
                            resolve({ source, data: `Data from ${source}`, timestamp: Date.now() });
                        } else {
                            reject(new Error(`Failed to fetch from ${source}`));
                        }
                    }, delay);
                });
            }
            
            const sources = [
                fetchFromSource("Primary API", 2000, 0.3),
                fetchFromSource("Backup API", 1500, 0.7),
                fetchFromSource("Cache", 500, 0.9),
                fetchFromSource("Database", 1000, 0.6)
            ];
            
            Promise.any(sources)
                .then(result => {
                    displayResult('any-result', `First successful source: ${JSON.stringify(result, null, 2)}`, 'success');
                })
                .catch(error => {
                    displayResult('any-result', `All sources failed: ${error.message}`, 'error');
                });
        }
        
        // Error handling demo
        function demoErrorHandling() {
            displayResult('error-result', 'Loading...', 'info');
            
            function fetchDataWithRetry(id, maxRetries = 3) {
                return new Promise((resolve, reject) => {
                    let attempts = 0;
                    
                    function attempt() {
                        attempts++;
                        const success = Math.random() > 0.4;
                        
                        if (success) {
                            resolve({ id, data: `Data ${id}`, attempts });
                        } else if (attempts < maxRetries) {
                            console.log(`Attempt ${attempts} failed, retrying...`);
                            setTimeout(attempt, 1000 * attempts);
                        } else {
                            reject(new Error(`Failed after ${maxRetries} attempts`));
                        }
                    }
                    
                    attempt();
                });
            }
            
            fetchDataWithRetry(1)
                .then(data => {
                    displayResult('error-result', `Success: ${JSON.stringify(data, null, 2)}`, 'success');
                })
                .catch(error => {
                    displayResult('error-result', `Primary fetch failed: ${error.message}\nFalling back to cached data...`, 'error');
                    
                    // Simulate fallback
                    setTimeout(() => {
                        displayResult('error-result', `Fallback successful: ${JSON.stringify({ id: 1, data: "Cached data", fromCache: true }, null, 2)}`, 'success');
                    }, 1000);
                });
        }
        
        // Custom utilities demo
        function demoCustomUtilities() {
            displayResult('utilities-result', 'Loading...', 'info');
            
            class PromiseUtils {
                static delay(ms) {
                    return new Promise(resolve => setTimeout(resolve, ms));
                }
                
                static timeout(promise, ms) {
                    return Promise.race([
                        promise,
                        new Promise((_, reject) => 
                            setTimeout(() => reject(new Error('Timeout')), ms)
                        )
                    ]);
                }
                
                static retry(fn, maxRetries = 3, delay = 1000) {
                    return new Promise((resolve, reject) => {
                        function attempt(attempts) {
                            fn()
                                .then(resolve)
                                .catch(error => {
                                    if (attempts < maxRetries) {
                                        setTimeout(() => attempt(attempts + 1), delay * attempts);
                                    } else {
                                        reject(error);
                                    }
                                });
                        }
                        attempt(1);
                    });
                }
            }
            
            let result = "Testing Promise utilities:\n\n";
            
            // Test delay
            result += "1. Testing delay utility...\n";
            PromiseUtils.delay(1000)
                .then(() => {
                    result += "   Delay completed successfully!\n\n";
                    
                    // Test timeout
                    result += "2. Testing timeout utility...\n";
                    const slowPromise = new Promise(resolve => setTimeout(resolve, 2000));
                    return PromiseUtils.timeout(slowPromise, 1000);
                })
                .then(() => {
                    result += "   Timeout test completed!\n\n";
                    
                    // Test retry
                    result += "3. Testing retry utility...\n";
                    let attempts = 0;
                    const flakyFunction = () => {
                        attempts++;
                        return new Promise((resolve, reject) => {
                            setTimeout(() => {
                                if (Math.random() > 0.6) {
                                    resolve(`Success on attempt ${attempts}`);
                                } else {
                                    reject(new Error(`Failed on attempt ${attempts}`));
                                }
                            }, 500);
                        });
                    };
                    
                    return PromiseUtils.retry(flakyFunction, 3, 500);
                })
                .then(retryResult => {
                    result += `   Retry successful: ${retryResult}\n\n`;
                    result += "All utilities tested successfully!";
                    displayResult('utilities-result', result, 'success');
                })
                .catch(error => {
                    result += `   Error: ${error.message}\n\n`;
                    result += "Some utilities failed, but that's expected in this demo!";
                    displayResult('utilities-result', result, 'success');
                });
        }
    </script>
</body>
</html>


