<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Level 20: Performance Optimization - Frontend Mastery Hub</title>
    <link rel="stylesheet" href="level20-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="level-container">
        <header class="level-header">
            <div class="level-info">
                <h1><i class="fas fa-tachometer-alt"></i> Level 20: Performance Optimization</h1>
                <p>Master web performance optimization techniques, monitoring, and best practices</p>
                <div class="level-stats">
                    <span class="stat"><i class="fas fa-code"></i> 5 Exercises</span>
                    <span class="stat"><i class="fas fa-clock"></i> 45-60 min</span>
                    <span class="stat"><i class="fas fa-star"></i> Advanced</span>
                </div>
            </div>
            <div class="progress-indicator">
                <div class="progress-bar">
                    <div class="progress-fill" id="overallProgress"></div>
                </div>
                <span class="progress-text">0/5 Complete</span>
            </div>
        </header>

        <div class="exercises-container">
            <!-- Exercise 1: Bundle Optimization -->
            <div class="exercise-card" data-exercise="1">
                <div class="exercise-header">
                    <h3><i class="fas fa-box"></i> Exercise 1: Bundle Optimization</h3>
                    <div class="exercise-status">
                        <i class="fas fa-circle status-pending"></i>
                        <span>Pending</span>
                    </div>
                </div>
                <div class="exercise-content">
                    <div class="exercise-description">
                        <p>Learn to optimize JavaScript bundles using code splitting, tree shaking, and dynamic imports. Implement lazy loading and reduce bundle size.</p>
                        <div class="exercise-hints">
                            <h4><i class="fas fa-lightbulb"></i> Key Concepts:</h4>
                            <ul>
                                <li>Code splitting with dynamic imports</li>
                                <li>Tree shaking for dead code elimination</li>
                                <li>Bundle analysis and optimization</li>
                                <li>Lazy loading strategies</li>
                            </ul>
                        </div>
                    </div>
                    <div class="code-editor">
                        <div class="editor-header">
                            <span>Bundle Optimization Implementation</span>
                            <button class="run-btn" onclick="runExercise(1)">
                                <i class="fas fa-play"></i> Run
                            </button>
                        </div>
                        <div class="editor-container">
                            <textarea id="editor1" placeholder="// Implement bundle optimization techniques
// Use dynamic imports for code splitting
// Implement tree shaking
// Add lazy loading for components

// Example: Dynamic import for a heavy component
const loadHeavyComponent = async () => {
  const module = await import('./HeavyComponent.js');
  return module.default;
};

// Example: Tree shaking optimization
import { specificFunction } from 'large-library';
// Instead of: import * as library from 'large-library';

// Example: Lazy loading with React
const LazyComponent = React.lazy(() => import('./LazyComponent'));

// Example: Bundle analysis
const analyzeBundle = () => {
  // Use webpack-bundle-analyzer or similar tools
  console.log('Bundle size analysis...');
};"></textarea>
                        </div>
                    </div>
                    <div class="output-panel" id="output1">
                        <div class="output-header">
                            <span>Performance Metrics</span>
                            <div class="metrics">
                                <span class="metric">Bundle Size: <span id="bundleSize">0 KB</span></span>
                                <span class="metric">Load Time: <span id="loadTime">0 ms</span></span>
                                <span class="metric">Chunks: <span id="chunkCount">0</span></span>
                            </div>
                        </div>
                        <div class="output-content" id="outputContent1"></div>
                    </div>
                </div>
            </div>

            <!-- Exercise 2: Image Optimization -->
            <div class="exercise-card" data-exercise="2">
                <div class="exercise-header">
                    <h3><i class="fas fa-image"></i> Exercise 2: Image Optimization</h3>
                    <div class="exercise-status">
                        <i class="fas fa-circle status-pending"></i>
                        <span>Pending</span>
                    </div>
                </div>
                <div class="exercise-content">
                    <div class="exercise-description">
                        <p>Optimize images for web performance using modern formats, lazy loading, responsive images, and compression techniques.</p>
                        <div class="exercise-hints">
                            <h4><i class="fas fa-lightbulb"></i> Key Concepts:</h4>
                            <ul>
                                <li>WebP and AVIF image formats</li>
                                <li>Responsive images with srcset</li>
                                <li>Lazy loading implementation</li>
                                <li>Image compression and optimization</li>
                            </ul>
                        </div>
                    </div>
                    <div class="code-editor">
                        <div class="editor-header">
                            <span>Image Optimization Implementation</span>
                            <button class="run-btn" onclick="runExercise(2)">
                                <i class="fas fa-play"></i> Run
                            </button>
                        </div>
                        <div class="editor-container">
                            <textarea id="editor2" placeholder="// Implement image optimization techniques
// Use modern image formats
// Implement responsive images
// Add lazy loading

// Example: Responsive images with srcset
const createResponsiveImage = (src, alt) => {
  const img = document.createElement('img');
  img.src = src;
  img.alt = alt;
  img.loading = 'lazy';
  img.srcset = \`\${src}-320w.webp 320w,
                \${src}-640w.webp 640w,
                \${src}-1280w.webp 1280w\`;
  img.sizes = '(max-width: 320px) 320px, (max-width: 640px) 640px, 1280px';
  return img;
};

// Example: Lazy loading with Intersection Observer
const setupLazyLoading = () => {
  const images = document.querySelectorAll('img[data-src]');
  const imageObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const img = entry.target;
        img.src = img.dataset.src;
        img.classList.remove('lazy');
        imageObserver.unobserve(img);
      }
    });
  });
  
  images.forEach(img => imageObserver.observe(img));
};

// Example: Image compression
const compressImage = (file, quality = 0.8) => {
  return new Promise((resolve) => {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();
    
    img.onload = () => {
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0);
      canvas.toBlob(resolve, 'image/webp', quality);
    };
    
    img.src = URL.createObjectURL(file);
  });
};"></textarea>
                        </div>
                    </div>
                    <div class="output-panel" id="output2">
                        <div class="output-header">
                            <span>Image Performance</span>
                            <div class="metrics">
                                <span class="metric">Format: <span id="imageFormat">Original</span></span>
                                <span class="metric">Size: <span id="imageSize">0 KB</span></span>
                                <span class="metric">Load Time: <span id="imageLoadTime">0 ms</span></span>
                            </div>
                        </div>
                        <div class="output-content" id="outputContent2"></div>
                    </div>
                </div>
            </div>

            <!-- Exercise 3: Caching Strategies -->
            <div class="exercise-card" data-exercise="3">
                <div class="exercise-header">
                    <h3><i class="fas fa-database"></i> Exercise 3: Caching Strategies</h3>
                    <div class="exercise-status">
                        <i class="fas fa-circle status-pending"></i>
                        <span>Pending</span>
                    </div>
                </div>
                <div class="exercise-content">
                    <div class="exercise-description">
                        <p>Implement various caching strategies including HTTP caching, service worker caching, and memory caching for optimal performance.</p>
                        <div class="exercise-hints">
                            <h4><i class="fas fa-lightbulb"></i> Key Concepts:</h4>
                            <ul>
                                <li>HTTP caching headers (Cache-Control, ETag)</li>
                                <li>Service Worker caching strategies</li>
                                <li>Memory caching and memoization</li>
                                <li>CDN and edge caching</li>
                            </ul>
                        </div>
                    </div>
                    <div class="code-editor">
                        <div class="editor-header">
                            <span>Caching Implementation</span>
                            <button class="run-btn" onclick="runExercise(3)">
                                <i class="fas fa-play"></i> Run
                            </button>
                        </div>
                        <div class="editor-container">
                            <textarea id="editor3" placeholder="// Implement caching strategies
// HTTP caching headers
// Service Worker caching
// Memory caching and memoization

// Example: HTTP caching headers
const setCacheHeaders = (res, maxAge = 3600) => {
  res.setHeader('Cache-Control', \`public, max-age=\${maxAge}\`);
  res.setHeader('ETag', generateETag(res.body));
  res.setHeader('Last-Modified', new Date().toUTCString());
};

// Example: Service Worker caching
const CACHE_NAME = 'app-cache-v1';
const urlsToCache = [
  '/',
  '/styles.css',
  '/script.js',
  '/images/logo.png'
];

self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(cache => cache.addAll(urlsToCache))
  );
});

self.addEventListener('fetch', (event) => {
  event.respondWith(
    caches.match(event.request)
      .then(response => {
        if (response) {
          return response;
        }
        return fetch(event.request);
      })
  );
});

// Example: Memory caching with memoization
const memoize = (fn) => {
  const cache = new Map();
  return (...args) => {
    const key = JSON.stringify(args);
    if (cache.has(key)) {
      return cache.get(key);
    }
    const result = fn(...args);
    cache.set(key, result);
    return result;
  };
};

// Example: LRU Cache implementation
class LRUCache {
  constructor(capacity) {
    this.capacity = capacity;
    this.cache = new Map();
  }
  
  get(key) {
    if (this.cache.has(key)) {
      const value = this.cache.get(key);
      this.cache.delete(key);
      this.cache.set(key, value);
      return value;
    }
    return -1;
  }
  
  set(key, value) {
    if (this.cache.has(key)) {
      this.cache.delete(key);
    } else if (this.cache.size >= this.capacity) {
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    this.cache.set(key, value);
  }
}"></textarea>
                        </div>
                    </div>
                    <div class="output-panel" id="output3">
                        <div class="output-header">
                            <span>Cache Performance</span>
                            <div class="metrics">
                                <span class="metric">Hit Rate: <span id="cacheHitRate">0%</span></span>
                                <span class="metric">Size: <span id="cacheSize">0 KB</span></span>
                                <span class="metric">Requests: <span id="cacheRequests">0</span></span>
                            </div>
                        </div>
                        <div class="output-content" id="outputContent3"></div>
                    </div>
                </div>
            </div>

            <!-- Exercise 4: Performance Monitoring -->
            <div class="exercise-card" data-exercise="4">
                <div class="exercise-header">
                    <h3><i class="fas fa-chart-line"></i> Exercise 4: Performance Monitoring</h3>
                    <div class="exercise-status">
                        <i class="fas fa-circle status-pending"></i>
                        <span>Pending</span>
                    </div>
                </div>
                <div class="exercise-content">
                    <div class="exercise-description">
                        <p>Implement performance monitoring using Web Vitals, Performance API, and real-time metrics collection for web applications.</p>
                        <div class="exercise-hints">
                            <h4><i class="fas fa-lightbulb"></i> Key Concepts:</h4>
                            <ul>
                                <li>Core Web Vitals (LCP, FID, CLS)</li>
                                <li>Performance API and timing metrics</li>
                                <li>Real-time monitoring and alerting</li>
                                <li>Performance budgets and thresholds</li>
                            </ul>
                        </div>
                    </div>
                    <div class="code-editor">
                        <div class="editor-header">
                            <span>Performance Monitoring Implementation</span>
                            <button class="run-btn" onclick="runExercise(4)">
                                <i class="fas fa-play"></i> Run
                            </button>
                        </div>
                        <div class="editor-container">
                            <textarea id="editor4" placeholder="// Implement performance monitoring
// Core Web Vitals
// Performance API
// Real-time metrics collection

// Example: Core Web Vitals measurement
const measureWebVitals = () => {
  // Largest Contentful Paint (LCP)
  const lcpObserver = new PerformanceObserver((list) => {
    const entries = list.getEntries();
    const lastEntry = entries[entries.length - 1];
    console.log('LCP:', lastEntry.startTime);
  });
  lcpObserver.observe({ entryTypes: ['largest-contentful-paint'] });

  // First Input Delay (FID)
  const fidObserver = new PerformanceObserver((list) => {
    const entries = list.getEntries();
    entries.forEach(entry => {
      console.log('FID:', entry.processingStart - entry.startTime);
    });
  });
  fidObserver.observe({ entryTypes: ['first-input'] });

  // Cumulative Layout Shift (CLS)
  let clsValue = 0;
  const clsObserver = new PerformanceObserver((list) => {
    const entries = list.getEntries();
    entries.forEach(entry => {
      if (!entry.hadRecentInput) {
        clsValue += entry.value;
      }
    });
    console.log('CLS:', clsValue);
  });
  clsObserver.observe({ entryTypes: ['layout-shift'] });
};

// Example: Performance API usage
const measurePerformance = () => {
  const navigation = performance.getEntriesByType('navigation')[0];
  const paint = performance.getEntriesByType('paint');
  
  const metrics = {
    domContentLoaded: navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart,
    loadComplete: navigation.loadEventEnd - navigation.loadEventStart,
    firstPaint: paint.find(p => p.name === 'first-paint')?.startTime,
    firstContentfulPaint: paint.find(p => p.name === 'first-contentful-paint')?.startTime
  };
  
  return metrics;
};

// Example: Real-time performance monitoring
class PerformanceMonitor {
  constructor() {
    this.metrics = new Map();
    this.thresholds = {
      lcp: 2500,
      fid: 100,
      cls: 0.1
    };
  }
  
  collectMetrics() {
    const navigation = performance.getEntriesByType('navigation')[0];
    const paint = performance.getEntriesByType('paint');
    
    this.metrics.set('domContentLoaded', navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart);
    this.metrics.set('loadComplete', navigation.loadEventEnd - navigation.loadEventStart);
    this.metrics.set('firstPaint', paint.find(p => p.name === 'first-paint')?.startTime || 0);
    this.metrics.set('firstContentfulPaint', paint.find(p => p.name === 'first-contentful-paint')?.startTime || 0);
  }
  
  checkThresholds() {
    const alerts = [];
    this.metrics.forEach((value, key) => {
      if (this.thresholds[key] && value > this.thresholds[key]) {
        alerts.push(\`\${key} exceeded threshold: \${value}ms\`);
      }
    });
    return alerts;
  }
}"></textarea>
                        </div>
                    </div>
                    <div class="output-panel" id="output4">
                        <div class="output-header">
                            <span>Performance Metrics</span>
                            <div class="metrics">
                                <span class="metric">LCP: <span id="lcpValue">0 ms</span></span>
                                <span class="metric">FID: <span id="fidValue">0 ms</span></span>
                                <span class="metric">CLS: <span id="clsValue">0</span></span>
                            </div>
                        </div>
                        <div class="output-content" id="outputContent4"></div>
                    </div>
                </div>
            </div>

            <!-- Exercise 5: Advanced Optimization -->
            <div class="exercise-card" data-exercise="5">
                <div class="exercise-header">
                    <h3><i class="fas fa-rocket"></i> Exercise 5: Advanced Optimization</h3>
                    <div class="exercise-status">
                        <i class="fas fa-circle status-pending"></i>
                        <span>Pending</span>
                    </div>
                </div>
                <div class="exercise-content">
                    <div class="exercise-description">
                        <p>Implement advanced optimization techniques including preloading, prefetching, critical resource prioritization, and performance budgets.</p>
                        <div class="exercise-hints">
                            <h4><i class="fas fa-lightbulb"></i> Key Concepts:</h4>
                            <ul>
                                <li>Resource preloading and prefetching</li>
                                <li>Critical resource prioritization</li>
                                <li>Performance budgets and monitoring</li>
                                <li>Advanced bundling strategies</li>
                            </ul>
                        </div>
                    </div>
                    <div class="code-editor">
                        <div class="editor-header">
                            <span>Advanced Optimization Implementation</span>
                            <button class="run-btn" onclick="runExercise(5)">
                                <i class="fas fa-play"></i> Run
                            </button>
                        </div>
                        <div class="editor-container">
                            <textarea id="editor5" placeholder="// Implement advanced optimization techniques
// Resource preloading and prefetching
// Critical resource prioritization
// Performance budgets

// Example: Resource preloading
const preloadCriticalResources = () => {
  const criticalResources = [
    { href: '/styles/critical.css', as: 'style' },
    { href: '/fonts/main.woff2', as: 'font', type: 'font/woff2' },
    { href: '/images/hero.jpg', as: 'image' }
  ];
  
  criticalResources.forEach(resource => {
    const link = document.createElement('link');
    link.rel = 'preload';
    link.href = resource.href;
    link.as = resource.as;
    if (resource.type) link.type = resource.type;
    if (resource.as === 'font') link.crossOrigin = 'anonymous';
    document.head.appendChild(link);
  });
};

// Example: Prefetching for future navigation
const prefetchResources = () => {
  const prefetchResources = [
    '/pages/about.html',
    '/pages/contact.html',
    '/scripts/analytics.js'
  ];
  
  prefetchResources.forEach(href => {
    const link = document.createElement('link');
    link.rel = 'prefetch';
    link.href = href;
    document.head.appendChild(link);
  });
};

// Example: Performance budget implementation
class PerformanceBudget {
  constructor(budget) {
    this.budget = budget;
    this.currentMetrics = {};
  }
  
  checkBudget(metrics) {
    const violations = [];
    
    Object.keys(this.budget).forEach(metric => {
      if (metrics[metric] > this.budget[metric]) {
        violations.push({
          metric,
          budget: this.budget[metric],
          actual: metrics[metric],
          excess: metrics[metric] - this.budget[metric]
        });
      }
    });
    
    return violations;
  }
  
  reportViolations(violations) {
    if (violations.length > 0) {
      console.warn('Performance budget violations:', violations);
      // Send to monitoring service
      this.sendToMonitoring(violations);
    }
  }
}

// Example: Critical resource prioritization
const prioritizeResources = () => {
  // High priority: Critical CSS, fonts, above-the-fold images
  const highPriority = document.querySelectorAll('link[rel="preload"][as="style"], link[rel="preload"][as="font"]');
  highPriority.forEach(link => {
    link.setAttribute('fetchpriority', 'high');
  });
  
  // Low priority: Non-critical scripts, below-the-fold images
  const lowPriority = document.querySelectorAll('script[src*="analytics"], img[loading="lazy"]');
  lowPriority.forEach(element => {
    element.setAttribute('fetchpriority', 'low');
  });
};

// Example: Advanced bundling with webpack
const webpackConfig = {
  optimization: {
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          chunks: 'all',
        },
        common: {
          name: 'common',
          minChunks: 2,
          chunks: 'all',
          enforce: true
        }
      }
    }
  }
};"></textarea>
                        </div>
                    </div>
                    <div class="output-panel" id="output5">
                        <div class="output-header">
                            <span>Optimization Results</span>
                            <div class="metrics">
                                <span class="metric">Budget: <span id="budgetStatus">Within</span></span>
                                <span class="metric">Preloads: <span id="preloadCount">0</span></span>
                                <span class="metric">Score: <span id="optimizationScore">0/100</span></span>
                            </div>
                        </div>
                        <div class="output-content" id="outputContent5"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="level-actions">
            <button class="btn-secondary" onclick="resetLevel()">
                <i class="fas fa-redo"></i> Reset Level
            </button>
            <button class="btn-primary" onclick="completeLevel()" id="completeBtn" disabled>
                <i class="fas fa-check"></i> Complete Level
            </button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="level20-script.js"></script>
</body>
</html>


